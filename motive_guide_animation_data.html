<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Motive Animation System: Animation Data</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="commonprojectlogo">
    <img alt="Logo" src="fpl_logo_small.png"/>
  </td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Motive Animation System
   </div>
   <div style="font-size:12px;">
	 An open source project by
     <a href="https://developers.google.com/games/#Tools">FPL</a>.
  </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="usergroup0.html"><span>Building</span></a></li>
      <li><a href="usergroup1.html"><span>Programmer's&#160;Guide</span></a></li>
      <li><a href="motive_api_reference.html"><span>API&#160;Reference</span></a></li>
      <li><a href="motive_readme.html"><span>Readme</span></a></li>
      <li><a href="contributing.html"><span>Contributing</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('motive_guide_animation_data.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Animation Data </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Overview</h1>
<p><a class="el" href="index.html#motive_overview">Motive</a> animations are stored as a series of one-dimensional cubic <a href="https://en.wikipedia.org/wiki/Spline_(mathematics)">splines</a>. This is a distinguishing characteristic of Motive, since traditional animation systems store animation data sampled at a constant frequency (typically 30Hz).</p>
<p>Splines provides two important advantages over sampled data:</p>
<ol type="1">
<li>Splines are much more <b>memory efficient</b>, since most animation data is intrinsically low-frequency and smooth.</li>
<li>Splines are <b>less prone to jitter</b>, since they have fewer values and continuous derivatives.</li>
</ol>
<h1>Dual-Cubic Splines</h1>
<p>One-dimensional polynomial <a href="https://en.wikipedia.org/wiki/Spline_(mathematics)">splines</a> can be unwieldy. Low degree splines tend to overshoot the target. High degree splines tend to have extra wobbles instead of a smooth curve (see <a href="https://en.wikipedia.org/wiki/Runge%27s_phenomenon">Runge's phenomenon</a>).</p>
<p>Most animation <em>authoring</em> solutions use two-dimensional <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">Bezier splines</a>. They simulate a one-dimensional function by labeling the axes 'time' vs. 'value', and then ensuring the curve never folds back on itself.</p>
<p>This works great for <em>authoring</em> curves; animators love creating animations with Bezier splines. But <em>evaluating</em> curves is extremely slow&ndash;we must iteratively search for a 'time' to find its 'value'&ndash;so Bezier splines are not suitable as an in-game format for animations.</p>
<p>Dual cubic splines were developed for Motive as a way to maintain the speed of polynomial splines, but temper their unwieldiness. Their premise is simple: Whenever a cubic spline gets unwieldy, it is divided into two cubic splines that are better behaved.</p>
<p>Motive's <a class="el" href="motive_guide_anim_pipeline.html">anim_pipeline</a> converts Bezier splines and sampled data into dual cubic splines.</p>
<p>At runtime, the dual cubic splines are quickly evaluated by processing them in bulk, and by using the <a href="https://en.wikipedia.org/wiki/SIMD">SIMD</a> capabilities of the processor.</p>
<p>For more information on dual cubic splines, please read the <a href="https://github.com/google/motive/blob/master/docs/dual_cubics.pdf">dual cubic whitepaper</a> or watch the five minute <a href="https://www.youtube.com/watch?v=6ON6fYO4FbY">dual cubic lightning talk</a>.</p>
<h1>Animation Data Classes</h1>
<p>Animation data is built up from one-dimensional curves in <code>CompactSpline</code>. <code>CompactSplines</code> drive matrix operations to create 4x4 matrices in <code>MatrixAnim</code>. <code>MatrixAnims</code>, in turn, drive the individual bone animations of a <code>RigAnim</code>.</p>
<h2>CompactSpline</h2>
<p>One-dimensional spline data is held in <code>CompactSpline</code>. These splines are a series of nodes. Each node has a time (<code>x</code>), value (<code>y</code>), and derivative (<code>angle</code>).</p>
<p>When evaluating a <code>CompactSpline</code> we use the two neighboring nodes to create a polynomial curve (in Motive, we use <code>CubicCurves</code>), and then evaluate the curve to find its intermediate values. The evaluation is handled efficiently by the <code>BulkSplineEvaluator</code>.</p>
<p>Each node element is quantized to 16-bits, so one node requires only 6-bytes. The quantizing assumes that individual animation curves will vary over a limited enough range such that 16-bits (65536 possible values) will still give enough precision.</p>
<p>We have not seen precision problems with quantization, though theoretically it is possible. For example, if an animation translates extremely far at one point, and then extremely subtly at another point. Such animations may have to be divided into two animations. If you encounter precision problems, we would be interested in seeing it so please do contact us.</p>
<p>You can make a one-dimensional <a class="el" href="motive_guide_motivators.html">Motivator</a> follow a CompactSpline by initializing it with a <code>SmoothInit</code> and then calling <code>SetSpline()</code>. See the <a class="el" href="motive_guide_motivators.html#motive_guide_motivator_example">Motivator example</a> for details.</p>
<h2>MatrixAnim</h2>
<p>A <code>MatrixAnim</code> holds the data to drive a <code>MotivatorMatrix4f</code>, the Motivator that animates a 4x4 matrix.</p>
<p>A 4x4 matrix can move an entire model, without animating any of its component parts. We call this "popsicle stick animation". A 4x4 matrix can also animate a single bone of a model's skeleton. That is how RigAnim uses it (see below).</p>
<p>MatrixAnim data is stored as a series of one-dimensional translate, rotate, and scale operations. Each operation is driven by a <code>CompactSpline</code> or a constant value. The series of operations are held in the <code>MatrixOpArray</code> class.</p>
<p>There are no restrictions on the order or number of translates, rotates, and scales. You can translate by x, rotate about y, and then translate by x again. This is useful for when your rotation or scale pivot is non-zero, for instance.</p>
<p>You can provide a constant transform from which to start applying the series of operations. For example, <code>RigAnims</code> use this feature to represent the constant transformation from a bone to its parent.</p>
<h3>Rotation Format</h3>
<p>Rotations are output as <a href="https://en.wikipedia.org/wiki/Euler">Euler angles</a> instead of <a href="https://en.wikipedia.org/wiki/Quaternion">quaternions</a>. This has a few advantages,</p>
<ol type="1">
<li>It is much faster to apply an Euler angle to a transform matrix than a quaternion. Even applying three Euler angles is faster than one quaternion.</li>
<li>Most animations are authored in Eulers, so the runtime format will more closely match the authored value.</li>
<li>Euler angles easy to compact as 16-bit fixed point values. Quaternions are more difficult to represent as three 16-bit values (though theoretically that should be possible).</li>
<li>Euler angles are conceptually easier than quaternions.</li>
</ol>
<p><a href="https://en.wikipedia.org/wiki/Gimbal_lock">Gimbal lock</a> is often sited as the shortcoming of Euler angles. If you experience Gimbal lock problems, we would be interested in hearing from you. The runtime speedup alone is compelling enough reason to stick with Eulers, but of course consequent problems (though we haven't experienced any yet) will require solutions.</p>
<h2>RigAnim</h2>
<p>A <code>RigAnim</code> holds a series of <code>MatrixAnims</code> and a bone hierarchy. The <code>MatrixAnims</code> animate each bone relative to the bone's origin, and the hierarchy lets us convert each bone's transform from bone-space to model-space.</p>
<p>Each <code>RigAnim</code> has one "defining animation" that holds the union of all operations for each bone. The defining animation is calculated from a set of animations in <code>CreateDefiningAnim()</code>. It's important to initialize the underlying <code>MotivatorMatrix4fs</code> with the union of all operations so that we can smoothly blend between animations. For example, even if the target animation has a matrix operation that the current animation does not have, we can still blend to that operation because the defining animation initialized it. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-49880327-7', 'google.github.io');
ga('send', 'pageview');
</script>
</body>
</html>
